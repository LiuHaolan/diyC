<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="None">
  
  <link rel="shortcut icon" href="./img/favicon.ico">
  <title>Home - diyC</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="./css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Home";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/";
  </script>
  
  <script src="./js/jquery-2.1.1.min.js"></script>
  <script src="./js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="./js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> diyC</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1 current">
		
    <a class="current" href=".">Home</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#welcome-to-diyc">Welcome to diyC</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#important-note">Important note</a></li>
        
            <li><a class="toctree-l3" href="#prerequisites">Prerequisites</a></li>
        
            <li><a class="toctree-l3" href="#installation">Installation</a></li>
        
            <li><a class="toctree-l3" href="#preparing-images">Preparing images</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="usage/">Usage</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">diyC</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Home</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="welcome-to-diyc">Welcome to diyC</h1>
<p>A simple educational Linux container runtime. It is intentionally
simple and leaves a lot of stuff out. It is a single C file of roughly
400 lines showing the core features of the Linux used to build
containers. It includes also the creation of a container from an image
to clarify how these work together.</p>
<h2 id="important-note">Important note</h2>
<p>It plays with iptables to get the routing and isolation running so if
you have your own iptables rules make sure to save them before doing
anything else <code>sudo iptables-save</code> and <code>sudo iptables-restore</code> to
recover them in case something goes awry.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>This is a educational piece of software and is not very portable, here
are the prerequisites:</p>
<ul>
<li>recent Linux kernel supporting needed namespaces and cgroups</li>
<li>overlayfs installed</li>
<li>ip tool (iproute2 package)</li>
<li>iptables</li>
<li>gcc</li>
<li>make</li>
<li>bash</li>
</ul>
<p>Apart from overlayfs most of the distros are prepared and ready, if
not please consult your distro package manager. Overlayfs is in the
mainline kernel so it should be straightforward. It was merged in
version 3.18 but has been improved a lot so you should aim for kernel
4.x.</p>
<p><em>Note</em>: Kernel needs to be configured to support following namespaces
PID, mount, network and UTS, cgroups are needed as well. Most of the GNU/Linux distros have
this support enabled by default.</p>
<h2 id="installation">Installation</h2>
<ol>
<li><code>make setup</code></li>
</ol>
<p>It creates the necessary directory structure as well as prepares the
networking part like iptables rules, bridge (diyc0) and so on. To
remove the networking bits like bridge and iptables rules run <code>make
net-clean</code> which removes them all.</p>
<ol>
<li><code>make</code></li>
</ol>
<p>Builds the runtime.</p>
<ol>
<li>Done</li>
</ol>
<p>It also builds a <code>nsexec</code> which executes a local command in namespaces. See <code>nsexec --help</code> to see what namespaces are available. Usage is very simple <code>sudo ./nsexec -pnu myhost bash</code> will start a new bash in new pid, network and UTS namespace.</p>
<h2 id="preparing-images">Preparing images</h2>
<p>The image import and creation is not present but because images are
just <strong>TARBALLS</strong> there is no need for anything fancy.</p>
<h3 id="creating-the-tarball-using-docker">Creating the tarball using docker</h3>
<p>Using docker is the most straightforward. <code>docker pull</code> the image you
want, spin it up by <code>docker run -ti &lt;image&gt; &lt;command&gt;</code> and in
different terminal do <code>docker export &lt;container&gt; &gt; myimage.tar</code>. You
have the tarball ready.</p>
<h3 id="installing-image">Installing image</h3>
<p><code>make setup</code> creates an <code>images</code> subdirectory so <code>mkdir
images/myimage</code> followed by <code>tar -xf myimage.tar -C images/myimage/</code>
should do the trick.</p>
<p>See <a href="usage/">Usage to run a container</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="usage/" class="btn btn-neutral float-right" title="Usage">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
        <span style="margin-left: 15px"><a href="usage/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="./js/theme.js"></script>

</body>
</html>

<!--
MkDocs version : 0.16.3
Build Date UTC : 2017-04-20 19:29:02
-->
