<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Networking - Linux containers from scratch - diyC</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">
        <link href="../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Linux containers from scratch - diyC</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Building containers <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../namespaces/">Linux Namespaces</a>
</li>

                    
                        
<li >
    <a href="../cgroups/">Linux Cgroups</a>
</li>

                    
                        
<li class="active">
    <a href="./">Networking</a>
</li>

                    
                        
<li >
    <a href="../images-containers/">Images and containers</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">diyC <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../diyc/install/">Installation</a>
</li>

                    
                        
<li >
    <a href="../diyc/usage/">Running containers</a>
</li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../cgroups/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../images-containers/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/w-vi/diyC">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#containers-and-networking">Containers and networking</a></li>
        
            <li><a href="#virtual-ethernet-devices">Virtual ethernet devices</a></li>
        
            <li><a href="#connecting-containers-using-bridge">Connecting containers using bridge</a></li>
        
            <li><a href="#iptables">iptables</a></li>
        
            <li><a href="#more-to-read">More to read</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="containers-and-networking">Containers and networking<a class="headerlink" href="#containers-and-networking" title="Permanent link">#</a></h1>
<p>Containers without network access are in many cases pretty useless. If
the container should not share network resources with the host that is
has it's own network namespace we need to connect it somehow because
by default new network namespace has only loop device, you can add the
network device to a namespace but it can reside only in one of them.
Considering dozens of containers on a single host we are not going to
have enough physical interfaces.</p>
<h2 id="virtual-ethernet-devices">Virtual ethernet devices<a class="headerlink" href="#virtual-ethernet-devices" title="Permanent link">#</a></h2>
<p>In Linux you can create virtual ethernet devices, they come in pairs,
a so called veth pair, which you can think of as two ethernet cards
connected by a cable. using ip tool you can easily assign one of the
pair to the container's namespace and the other somewhere
else. Ideally
to <a href="https://wiki.linuxfoundation.org/networking/bridge">linux bridge</a>
or <a href="http://openvswitch.org/">Open vSwitch</a> so we can create virtual
networks.</p>
<h2 id="connecting-containers-using-bridge">Connecting containers using bridge<a class="headerlink" href="#connecting-containers-using-bridge" title="Permanent link">#</a></h2>
<p><img alt="Veth Bridge" src="../img/veth-bridge.png" /></p>
<div class="admonition seealso">
<p class="admonition-title">Code</p>
<p>Code in diyC uses <code>system()</code> function to shell out so you can
easily replicate it on the command line.<br />
<a href="https://github.com/w-vi/diyC/blob/master/src/diyc.c#L234-L271">diyc.c:234-271</a></p>
</div>
<h2 id="iptables">iptables<a class="headerlink" href="#iptables" title="Permanent link">#</a></h2>
<p>Once the containers are hooked up using veth pars and a bridge it
comes to iptables to do NAT and routing to allow containers to connect
to the outer world.</p>
<h2 id="more-to-read">More to read<a class="headerlink" href="#more-to-read" title="Permanent link">#</a></h2>
<ul>
<li><a href="http://www.opencloudblog.com/?p=66">Linux Switching â€“ Interconnecting Namespaces</a></li>
<li><a href="http://www.opencloudblog.com/?p=42">Linux Network Namespaces</a></li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>